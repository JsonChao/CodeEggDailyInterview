#### TCP/IP 如何保证可靠性，说说 TCP 头的结构

保证可靠性:
1、将数据截断为合理的长度;
2、超时重发;
3、对于收到的请求，给出确认响应;
4、 校验出包有错，丢弃报文段，不给出响应，TCP发送数据端，超时时会重发数据;
5、对失序数据进行重新排序，然后才交给应用层;
6、对于重复数据，能够丢弃重复数据;
7、TCP可以进行流量控制，防止较快主机致使较慢主机的缓冲区溢出;

[![图示](https://camo.githubusercontent.com/958a2320b26f9b66d5be29c19b3acf1c6909f62c/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303139303230333131323735353435342e706e673f782d6f73732d70726f636573733d696d6167652f77617465726d61726b2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c3270315a47646c616d46745a584d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730)](https://camo.githubusercontent.com/958a2320b26f9b66d5be29c19b3acf1c6909f62c/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303139303230333131323735353435342e706e673f782d6f73732d70726f636573733d696d6167652f77617465726d61726b2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c3270315a47646c616d46745a584d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730)
TCP固定头部结构：

- 16位端口号：包括了源端口号和目的端口号。进行TCP通信时，客户端通常使用系统自动选择的临时端口号(一般都很大)，而服务器则使用知服务端口号或服务器管理员自定义的端口号。
- 32位序号：一次TCP通信过程中对一个传输方向上的字节流的每个字节的编号(从这个方向第一个报文段依次排列)。假设主机A和主机B进行TCP通信，A发送给B的第一个TCP报文段中的序号值是系统初始化的一个随机值ISN(初始序号值)。那么之后在A到B的方向上发送的TCP报文段中的序号值将会被系统设置为ISN加上该报文段所携带数据的第一个字节在整个数据字节流中的偏移。
  32位确认号：用作对另一方发送来的TCP报文段做出相应。其值是收到对方的报文段的序号值加1。
- 4位头部长度：标识该TCP头部有多少个32bit字(4字节)。一共有4位，所以最大能表示TCP头部大小为60字节。
- 6位标志位包含如下几项：
  （1）URG标志，表示紧急指针是否有效。
  （2）ACK标志，表示确认号是否有效。一般称携带ACK标志的报文段是确认报文段。
  （3）PSH标志，提示接收端应用程序立即从TCP接受缓冲区读走数据。
  （4）RST标志，表示要求对方重新建立连接。称携带RST标志的TCP报文段为复位报文段。
  （5）SYN标志，表示请求建立一个连接。称携带SYN标志的TCP报文段为同步报文段。
  （6）FIN标志，表示通知对方本端将关闭连接。称携带FIN标志的TCP报文段为结束报文段。
- 16位窗口大小：是TCP流量控制的一个手段。这里说的窗口指的是接收通告窗口(RWND)。它告诉对方本端TCP接收缓冲区还能容纳多少字节的数据，以让对方控制发送数据的速度。
- 16位校验和：由发送端填充，接收端对TCP报文段执行CRC算法以效验TCP报文段在传输过程中是否损坏(包括TCP头部和数据部分)。这也是TCP可靠传输的一个重要保障。
- 16位紧急指针：是一个正的偏移量。它和序号字段的值相加表示最后一个紧急数据的下一字节的序号。即这个字段是紧急指针相对当前序号的偏移，为紧急偏移。以让接收端迅速接受到紧急数据。TCP的紧急指针是发送端向接收端发送紧急数据的方法。